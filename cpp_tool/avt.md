# 音视频学习参照[雷神的csdn](https://blog.csdn.net/leixiaohua1020?type=blog) 
主要是学习时的笔记
# 视频播放器的原理
- 视频播放器播放视频文件主要原理是:解协议，解封装，解码视音频，视音频同步。
- ![音视频播放流程](../images/av_flow.jpg) 
	- 解协议的作用，就是将流媒体协议的数据，解析为标准的相应的封装格式数据。视音频在网络上传播的时候，常常采用各种流媒体协议，例如HTTP,RTMP.或者是MMS等等，这些数据在传输音视频数据的同时，也会传输一些信令数据，这些信令数据包括对播放的控制(播放，暂停，停止),或者对网络状态的描述等。解协议的过程中会去除信令数据而只保留音视频数据，例如，采用RTMP协议传输的数据，经过解协议操作后，会输出FLV格式的数据。
	- 解封装的操作，就是将输入的封装格式的数据，分离成音频流压缩编码数据和视频流压缩编码数据。封装格式有很多种类，例如MP4,MKV,RMVB,TS,FLV,AVI等，它的作用就是将已经压缩编码的视频数据和音频数据按照一定的格式放在一起，例如：FLV格式的数据，经过解封装操作后，输出H.264编码的视频码流和AAC编码的音频码流。
	- 解码的作用就是将视频/音频压缩编码数据，解码成为非压缩的视频/音频原始数据，音频的压缩编码标准包含ACC,MP3,AC-3等等，视频的压缩编码标准则是包含H.264,MPEG2,VC-1等等。解码是整个系统中最重要也是最复杂的环节。通过解码，压缩编码的视频数据输出成为非压缩的颜色数据，例如：YUV420P, RGB等等；压缩编码的音视频数据输出成为非压缩编码的音频抽样数据，例如PCM数据。
	- 视音频同步的作用：就是根据解封装模块处理过程中获取到的参数信息，同步解码出来的视频和音频数据，并将视频音频数据送至系统的显卡和声卡播放出来。
# rtmp分析
- ![RTMP规范简单分析](https://blog.csdn.net/leixiaohua1020/article/details/11694129)
rtmp传输媒体数据的过程中，发送端首先把媒体数据封装成消息，然后把消息分割成消息块，最后将分割后的消息块通过TCP协议发送出去，接收端在通过TCP协议收到数据后，先把消息块重新组合成消息，然后通过对消息进行封装处理就可以恢复出媒体数据。
# UDP-RTP协议分析

# SDL配置
- SDL(Simple DirectMedia Layer)库的作用是封装了复杂的视音频低层交互工作，简化视音频处理的难度。
# ts流格式介绍
- ts流最早应用于数字电视领域，视频格式主要是mpeg2，苹果公司的(http live stream)hls流媒体是基于ts，主要的封装格式是h264/mpeg4,音频为aac/mp3.
- ts格式:ts层，pes层，es层。es层就是音视频数据。pes层是在音视频数据上加了时间戳等对数据帧的说明信息。ts层就是在pes层上加了数据流标识和传输的必要信息。
- ts header  

| 名称                         | 字节 | 含义                                                                                          |
| ---                          | ---  | ---                                                                                           |
| sync\_byte                   | 8b   | 同步字节，固定为0x47                                                                          |
| tranport\_erro\_indicator    | 1b   | 传输错误指示，通常为0                                                                         |
| payload_unit_start_indicator | 1b   | 负载单元起始标示符，一个完整的数据包开始时标记为1                                             |
| transport_priority           | 1b   | 传输优先级，0为低优先级，1为高优先级，通常取0                                                 |
| pid                          | 13b  | pid值                                                                                         |
| transport_scrambling_control | 2b   | 传输加扰控制，00表示未加密                                                                    |
| adaption_filed_control       | 2b   | 是否包含自适应00保留，01无自适应，仅含负载，10自适应，无有效负载； 11同时具有自适应和有效负载 |
| cibtinuity_counter           | 4b   | 递增计数器，从0-f，起始值不一定取0，但必须是连续的                                            |
[参考文章](https://blog.csdn.net/yhc223/article/details/43952681)

pts是显示时间戳，dts是解码时间戳，视频数据两种时间戳都需要，音频数据的pts和dts相同，所以只需要pts.有pts和dts两种时间戳是B帧(双向探测帧),I帧和P帧的pts等于dts。如果同一个视频没有B帧，则pts永远和dts相同，从文件中顺序读取视频帧，取出的帧顺序和dts顺序相同。dts算法比较简单，就是直接初始值+增量即可，pts计算比较复杂，需要dts的基础上加偏移量。


